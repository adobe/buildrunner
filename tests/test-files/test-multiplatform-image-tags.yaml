# Test case: Multiple multiplatform builds pushing to the same repository with different tags
# Verifies that each build step creates a separate artifact entry in artifacts.json
# rather than overwriting previous entries for the same repository
steps:
  build-java17:
    build:
      dockerfile: |
        FROM {{ DOCKER_REGISTRY }}/busybox:latest
        RUN echo "Testing multiplatform image tags"
      pull: true
      platforms:
        - linux/amd64
        - linux/arm64
    push:
      # First push - creates artifact entry for java17 tag
      repository: adobe/buildrunner-test-multitag
      tags: ['java17']

  build-java11:
    build:
      dockerfile: |
        FROM {{ DOCKER_REGISTRY }}/busybox:latest
        RUN echo "Testing multiplatform image tags"
      pull: true
      platforms:
        - linux/amd64
        - linux/arm64
    push:
      # Second push - creates separate artifact entry for java11 tag
      repository: adobe/buildrunner-test-multitag
      tags: ['java11']
