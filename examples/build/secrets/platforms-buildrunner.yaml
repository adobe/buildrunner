# In order to use secrets, you need to set use-legacy-builder to false in the config file OR
# add platforms to the build section
# To run this example, you need to set the SECRET_PASSWORD environment variable
# and run the example with the following command:
# SECRET2=my_secret ./run-buildrunner.sh -f examples/build/secrets/buildrunner-platforms.yaml
# More info about secrets: https://docs.docker.com/build/building/secrets/
steps:
  simple-build-step:
    build:
      dockerfile: |
        FROM alpine:latest
        RUN --mount=type=secret,id=secret1 \
            --mount=type=secret,id=secret2 \
            SECRET1_FILE=/run/secrets/secret1 \
            SECRET2_VARIABLE=$(cat /run/secrets/secret2) \
            echo "Using secrets in my build - secret1: $(cat $SECRET1_FILE) secret2: $SECRET2_VARIABLE"
      secrets:
        # Example of a secret that is a file
        - id=secret1,src=examples/build/secrets/secret1.txt
        # Example of a secret that is an environment variable
        - id=secret2,env=SECRET2
      platforms:
        - linux/amd64
        - linux/arm64
